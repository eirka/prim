"use strict";angular.module("prim",["ui.bootstrap","ngSanitize","ngRoute","ngResource","ngMessages"]),angular.module("prim").config(["$routeProvider","$locationProvider","$compileProvider","$httpProvider",function(e,t,r,o){e.when("/",{title:"Index",templateUrl:"pages/main.html",controller:"getIndex"}).when("/page/:id",{title:"Index",templateUrl:"pages/main.html",controller:"getIndex"}).when("/thread/:id/:page",{templateUrl:"pages/thread.html",controller:"getThread"}).when("/post/:id/:post",{templateUrl:"pages/post.html",controller:"getPost"}).when("/directory",{title:"Threads",templateUrl:"pages/directory.html",controller:"getDirectory"}).when("/image/:id",{templateUrl:"pages/image.html",controller:"getImage"}).when("/tags",{title:"Tags",templateUrl:"pages/tags.html",controller:"getTagList"}).when("/tag/:id/:page",{templateUrl:"pages/tag.html",controller:"getTag"}).when("/error",{templateUrl:"pages/error.html",controller:"errorHandler"}).otherwise({redirectTo:"/error"}),r.debugInfoEnabled(!1),t.html5Mode(!0),o.defaults.withCredentials=!0}]),angular.module("prim").constant("internal",{as_key:"j5ebMACL"}),angular.module("prim").run(["config","$rootScope",function(e,t){t.page={setTitle:function(t){this.title=t+" | "+e.title}},t.$on("$routeChangeSuccess",function(e,r){t.page.setTitle(r.$$route.title||"")})}]),angular.module("prim").directive("commentHandler",function(){return{restrict:"A",scope:{post:"=",thread:"="},templateUrl:"pages/comment.html",controller:["$scope",function(e){function t(e){n.push(e)}function r(e){g.push(e)}for(var o,a=/(>>(\d{1,4}))/,i=e.post.comment,n=[],g=[];o=i.match(a);){var s=o[2],l=o.index;t(i.substr(0,l)),r(s,o[0]),i=i.substring(l+o[0].length)}t(i),e.post.comment=n.join(""),e.post.quote_id=g}]}}),angular.module("prim").directive("quoteBox",["Post","$compile",function(e,t){return{restrict:"A",transclude:!0,scope:{ids:"=",thread:"="},templateUrl:"pages/hover.html",link:function(r,o,a){var i=angular.element(r.links),n=t(i)(r);i.append(n),r.show={},r.show.card=!1,r.hoverTmplUrl=a.hoverTmplUrl,r.onHoverIn=r.$eval(a.onHoverIn),r.onHoverOut=r.$eval(a.onHoverOut),r.getPost=function(t){e.get({thread:r.thread.id,id:t},function(e){r.quotebox=e})}}}}]),angular.module("prim").directive("topBox",function(){return{restrict:"E",scope:{},templateUrl:"pages/totop.html",controller:["$scope","$window",function(e,t){angular.element(t).bind("scroll",function(){e.showbox=!1,e.showbox=window.pageYOffset>300?!0:!1,e.$applyAsync()}),e.scrollToTop=function(){t.scrollTo(0,0)}}]}}),angular.module("prim").controller("getDirectory",["Directory","$scope","Utils",function(e,t,r){e.get(function(e){t.data=e},function(e){r.apiError(e.status)}),t.predicate="-last_post"}]),angular.module("prim").service("Directory",["$resource","config",function(e,t){return e(t.api_srv+"/get/directory/:ib",{ib:t.ib_id},{get:{method:"GET"}})}]),angular.module("prim").controller("errorHandler",["$scope","Utils",function(e,t){switch(e.errorcode=t.getError(),""===e.errorcode&&(e.errorcode="???"),e.errorcode){case 404:e.page.setTitle("Not Found");break;case 502:e.page.setTitle("API Down");break;default:e.page.setTitle("Error")}}]),angular.module("prim").factory("Utils",["$location","$sce","config",function(e,t,r){var o="",a="";return{setQuote:function(e){o+=">>"+e+" "},getQuote:function(){return o},clearQuote:function(){o=""},apiError:function(t){a=t,e.path("/error")},getError:function(){return a},getFormAction:function(e){return t.trustAsResourceUrl(r.api_srv+e)},getImgSrc:function(e){return t.trustAsResourceUrl(r.img_srv+"/src/"+e)}}}]),angular.module("prim").controller("getImage",["config","internal","Image","TagList","AddTag","$routeParams","$scope","Utils",function(e,t,r,o,a,i,n,g){function s(e){for(var t=0;t<n.tagList.length;t++)if(e===n.tagList[t].id)return n.tagList[t].tag}n.getImgSrc=g.getImgSrc,r.get({id:i.id},function(e){n.data=e,n.image=e.image,n.page.setTitle("Image "+n.image.id),n.tags=e.image.tags,n.ext=e.image.filename.split(".").pop()},function(e){g.apiError(e.status)}),o.get(function(e){n.tagList=e.tags}),n.tagList={},n.formatLabel=s,n.updateTags=function(){r.get({id:i.id},function(e){n.tags=e.image.tags,n.error=null,n.selected=null})},n.addTag=function(){"number"==typeof n.selected&&n.selected%1===0?a.save({tag:n.selected,image:n.image.id,ib:e.ib_id,askey:t.as_key},function(){n.updateTags()},function(e){n.error=e.data}):(n.data.error_message="Tag does not exist",n.error=n.data)}}]),angular.module("prim").service("Image",["$resource","config",function(e,t){return e(t.api_srv+"/get/image/:ib/:id",{ib:t.ib_id,id:"@id"},{get:{method:"GET"}})}]),angular.module("prim").controller("getIndex",["config","internal","$scope","$location","Index","$routeParams","Utils",function(e,t,r,o,a,i,n){r.as_key=t.as_key,r.ib_id=e.ib_id,r.getFormAction=n.getFormAction,i.id||(i.id=1),a.get({id:i.id},function(e){r.data=e,r.totalItems=e.index.total,r.currentPage=e.index.current_page,r.numPages=e.index.pages,r.itemsPerPage=e.index.per_page,r.maxSize=5,r.replyQuote=function(e,t,r){n.setQuote(e),o.path("/thread/"+t+"/"+r)}},function(e){n.apiError(e.status)})}]),angular.module("prim").service("Index",["$resource","config",function(e,t){return e(t.api_srv+"/get/index/:ib/:id",{ib:t.ib_id,id:"@id"},{get:{method:"GET"}})}]),angular.module("prim").controller("getPost",["Post","$location","$routeParams","$scope","Utils",function(e,t,r,o,a){e.get({thread:r.id,id:r.post},function(e){o.data=e,o.post=e.post,o.page.setTitle("Post "+o.post.thread_id+"/"+o.post.num),o.replyQuote=function(e,r,o){a.setQuote(e),t.path("/thread/"+r+"/"+o)}},function(e){a.apiError(e.status)})}]),angular.module("prim").service("Post",["$resource","config",function(e,t){return e(t.api_srv+"/get/post/:ib/:thread/:id",{ib:t.ib_id,thread:"@thread",id:"@id"},{get:{method:"GET",cache:!0}})}]),angular.module("prim").controller("getTag",["$scope","Tag","$routeParams","Utils",function(e,t,r,o){t.get({id:r.id,page:r.page},function(t){e.data=t,e.tag=t.tag.items,e.totalItems=t.tag.total,e.currentPage=t.tag.current_page,e.numPages=t.tag.pages,e.itemsPerPage=t.tag.per_page,e.maxSize=3,e.page.setTitle(e.tag.tag)},function(e){o.apiError(e.status)})}]),angular.module("prim").service("Tag",["$resource","config",function(e,t){return e(t.api_srv+"/get/tag/:ib/:id/:page",{ib:t.ib_id,id:"@id",page:"@page"},{get:{method:"GET"}})}]),angular.module("prim").service("AddTag",["$resource","config",function(e,t){return e(t.api_srv+"/post/tag/add",{},{save:{method:"POST"}})}]),angular.module("prim").service("NewTag",["$resource","config",function(e,t){return e(t.api_srv+"/post/tag/new",{},{save:{method:"POST"}})}]),angular.module("prim").controller("getThread",["config","internal","Thread","$window","$location","$scope","$routeParams","Utils",function(e,t,r,o,a,i,n,g){i.as_key=t.as_key,i.ib_id=e.ib_id,i.layout="list",i.getFormAction=g.getFormAction,n.page||(n.page=1),i.quote=g.getQuote(),i.$on("$locationChangeStart",function(){g.clearQuote()}),r.get({id:n.id,page:n.page},function(e){i.data=e,i.thread=e.thread.items,i.page.setTitle(i.thread.title),i.totalItems=e.thread.total,i.currentPage=e.thread.current_page,i.numPages=e.thread.pages,i.itemsPerPage=e.thread.per_page,i.maxSize=3},function(e){g.apiError(e.status)}),i.replyQuote=function(e){g.setQuote(e),i.quote=g.getQuote(),o.scrollTo(0,0)}}]),angular.module("prim").service("Thread",["$resource","config",function(e,t){return e(t.api_srv+"/get/thread/:ib/:id/:page",{ib:t.ib_id,id:"@id",page:"@page"},{get:{method:"GET"}})}]),angular.module("prim").controller("getTagList",["config","internal","TagList","TagTypes","NewTag","$scope","Utils",function(e,t,r,o,a,i,n){o.get(function(e){i.tagTypes=e.tagtypes},function(e){n.apiError(e.status)}),i.updateTags=function(){i.data=r.get(),i.error=null},i.updateTags(),i.newTag=function(){a.save({name:i.name,type:i.selected,ib:e.ib_id,askey:t.as_key},function(){i.updateTags()},function(e){i.error=e.data})},i.predicate="total"}]),angular.module("prim").service("TagList",["$resource","config",function(e,t){return e(t.api_srv+"/get/tags/:ib",{ib:t.ib_id},{get:{method:"GET"}})}]),angular.module("prim").service("TagTypes",["$resource","config",function(e,t){return e(t.api_srv+"/get/tagtypes",{},{get:{method:"GET",cache:!0}})}]);